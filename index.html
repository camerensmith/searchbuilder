<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="https://i.postimg.cc/34M4mLpk/q.png" />
  <title>Search Builder</title>
  <style>
    :root {
      --bg-page: #eef2ff;
      --bg-card: #ffffff;
      --border-card: #e5e7f1;
      --shadow-card: 0 20px 45px rgba(15, 23, 42, 0.08);
      --text-primary: #1f2937;
      --text-muted: #6b7280;
      --accent: #1a73e8;
      --accent-soft: rgba(26, 115, 232, 0.16);
    }
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #eef2ff 0%, #f9fbff 100%);
      margin: 0;
      color: var(--text-primary);
    }
    .container {
      max-width: 1080px;
      margin: 0 auto;
      padding: 2.5rem 1.5rem 4rem;
      min-height: 100vh;
    }
    .page-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    .page-header h1 {
      font-size: 2.25rem;
      margin: 0 0 0.5rem;
      font-weight: 700;
    }
    p.subtitle {
      margin: 0 auto;
      max-width: 720px;
      color: var(--text-muted);
      font-size: 1rem;
      line-height: 1.6;
    }
    .section-card {
      background: var(--bg-card);
      border: 1px solid var(--border-card);
      border-radius: 18px;
      padding: 1.6rem;
      box-shadow: var(--shadow-card);
      margin-bottom: 1.8rem;
    }
    .section-title {
      font-size: 1.15rem;
      font-weight: 600;
      margin: 0 0 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .section-subtitle {
      font-size: 0.95rem;
      font-weight: 600;
      margin: 1.2rem 0 0.75rem;
      color: var(--text-primary);
    }
    label {
      font-weight: 600;
      display: block;
      margin-bottom: 0.4rem;
    }
    label.section-title {
      font-size: 1.15rem;
      margin-bottom: 1rem;
    }
    textarea,
    input[type="text"],
    select {
      width: 100%;
      padding: 0.65rem 0.75rem;
      border: 1px solid #d5dce8;
      border-radius: 12px;
      font-family: inherit;
      margin-bottom: 0.65rem;
      background: #f9fbff;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }
    textarea {
      resize: vertical;
      min-height: 90px;
    }
    textarea:focus,
    input[type="text"]:focus,
    select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-soft);
      background: #fff;
    }
    small {
      display: block;
      color: var(--text-muted);
      margin-bottom: 0.8rem;
      line-height: 1.5;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 1.5rem;
      margin-bottom: 1.8rem;
    }
    .grid .section-card {
      margin-bottom: 0;
    }
    .checkbox-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-bottom: 0.9rem;
    }
    .checkbox-row label {
      font-weight: 500;
      background: #f2f6ff;
      border: 1px solid #dbe5ff;
      border-radius: 999px;
      padding: 0.35rem 0.85rem;
      display: flex;
      align-items: center;
      gap: 0.45rem;
      transition: background 0.2s ease, border-color 0.2s ease;
      cursor: pointer;
    }
    .checkbox-row label:hover {
      border-color: var(--accent);
      background: rgba(26, 115, 232, 0.12);
    }
    .checkbox-row label input {
      margin: 0;
    }
    .checkbox-row button {
      border-radius: 999px;
      padding: 0.4rem 0.9rem;
      margin: 0;
      font-size: 0.92rem;
    }
    .toolbar-row,
    .saved-queries__row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-bottom: 1rem;
      align-items: center;
    }
    .toolbar-row input[type="text"] {
      flex: 1 1 260px;
      margin-bottom: 0;
    }
    .toolbar-row button {
      margin: 0;
    }
    #bookmarkList {
      display: flex;
      flex-wrap: wrap;
      gap: 0.7rem;
      margin-bottom: 0.5rem;
    }
    #bookmarkList:empty::before {
      content: "No bookmarks yet. Add one above to keep it handy.";
      color: var(--text-muted);
      font-size: 0.9rem;
    }
    #bookmarkList a {
      background: #f1f5ff;
      border: 1px solid #dbe3f8;
      border-radius: 12px;
      padding: 0.45rem 0.75rem;
      text-decoration: none;
      color: var(--text-primary);
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }
    #bookmarkList a:hover {
      transform: translateY(-2px);
      box-shadow: 0 16px 24px rgba(15, 23, 42, 0.12);
    }
    #bookmarkList img {
      border-radius: 50%;
      background: #fff;
    }
    .saved-queries__row select {
      flex: 1 1 200px;
      min-width: 200px;
    }
    .saved-queries__row input[type="text"] {
      flex: 2 1 240px;
      margin-bottom: 0;
    }
    button {
      padding: 0.65rem 1.15rem;
      border-radius: 12px;
      border: 1px solid #d5dce8;
      background: #f7f9ff;
      cursor: pointer;
      font-weight: 600;
      margin-right: 0.3rem;
      margin-bottom: 0.3rem;
      transition: background 0.2s ease, transform 0.15s ease, box-shadow 0.15s ease;
    }
    button:hover:not(:disabled) {
      background: #edf3ff;
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(26, 115, 232, 0.15);
    }
    button.primary {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }
    button.primary:hover:not(:disabled) {
      background: #0f5ad7;
    }
    button:disabled {
      cursor: not-allowed;
      opacity: 0.6;
      box-shadow: none;
      transform: none;
    }
    #outputQuery {
      font-family: Menlo, Monaco, Consolas, monospace;
      background: #0f172a;
      color: #e2e8f0;
      border-radius: 12px;
      min-height: 160px;
      margin-bottom: 0.75rem;
    }
    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
    }
    .button-group button {
      margin: 0;
    }
    .actions-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      align-items: flex-end;
      justify-content: space-between;
    }
    .actions-grid > div:first-child {
      flex: 1 1 220px;
    }
    .output-card small {
      margin-bottom: 0;
    }
    @media (max-width: 680px) {
      .container {
        padding: 1.9rem 1rem 3rem;
      }
      .section-card {
        padding: 1.3rem;
      }
      .actions-grid {
        flex-direction: column;
        align-items: stretch;
      }
      .button-group {
        width: 100%;
        justify-content: stretch;
      }
      .button-group button {
        flex: 1 1 auto;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="page-header">
      <h1>Search Builder</h1>
      <p class="subtitle">
        Fill out the fields and hit <strong>Search</strong>. Itâ€™ll open Google, Bing, or DuckDuckGo with your Boolean query already filled in.
      </p>
    </header>

    <section class="section-card">
      <h2 class="section-title">Bookmarks &amp; Saved Queries</h2>
      <label for="bookmarkUrl">Bookmark a favorite site</label>
      <div class="toolbar-row">
        <input type="text" id="bookmarkUrl" placeholder="https://example.com/jobs" />
        <button id="addBookmarkBtn">+ Add Bookmark</button>
      </div>
      <div id="bookmarkList" class="bookmark-list"></div>

      <h3 class="section-subtitle">Saved queries</h3>
      <div class="saved-queries__row">
        <select id="savedQueries">
          <option value="">-- Select saved --</option>
        </select>
        <input type="text" id="saveName" placeholder="Name this query" />
        <button id="saveBtn">Save</button>
        <button id="loadBtn" disabled>Load</button>
        <button id="deleteBtn" disabled>Delete</button>
      </div>
    </section>

    <div class="grid">
      <section class="section-card">
        <label class="section-title" for="titles">Job titles (one per line)</label>
        <textarea id="titles" rows="8" placeholder="e.g.
IT Project Manager
Data Analyst
Staff Accountant"></textarea>
        <small>Each line becomes part of an OR group.</small>
      </section>
      <section class="section-card">
        <h2 class="section-title">Must-have keywords &amp; companies</h2>
        <label for="mustInclude">Must-include keywords (comma or newline)</label>
        <textarea id="mustInclude" rows="4" placeholder="e.g. fintech, healthcare, 'people ops'"></textarea>
        <small>E.g. company name, team name, niche skill.</small>

        <div class="checkbox-row">
          <label for="requireCompanies">
            <input type="checkbox" id="requireCompanies" /> Make companies required
          </label>
        </div>
        <label for="companies">Specific companies</label>
        <textarea id="companies" rows="4" placeholder="e.g.
Microsoft
Amazon
Distinctly"></textarea>
        <small>One per line or comma-separated. If 'Make companies required' is off, companies will be ignored.</small>
      </section>
      <section class="section-card">
        <h2 class="section-title">Target sites</h2>
        <small>Select common job boards or add your own domains below.</small>
        <div class="checkbox-row" id="sitePresetsRow">
          <label><input type="checkbox" id="siteIndeed" /> indeed.com/jobs</label>
          <label><input type="checkbox" id="siteLinkedIn" /> linkedin.com/jobs</label>
          <label><input type="checkbox" id="siteDice" /> dice.com/jobs</label>
          <label><input type="checkbox" id="siteBuiltIn" /> builtin.com/jobs</label>
          <label><input type="checkbox" id="siteGoogleJobs" /> jobs.google.com</label>
          <label><input type="checkbox" id="siteRobertHalf" /> roberthalf.com/us/en/jobs</label>
        </div>
        <label for="sites">Custom sites (one per line)</label>
        <textarea id="sites" rows="5" placeholder="e.g.
linkedin.com
indeed.com
glassdoor.com"></textarea>
        <small>Examples: linkedin.com, indeed.com, glassdoor.com, etc.</small>
      </section>
      <section class="section-card">
        <h2 class="section-title">Work mode &amp; location</h2>
        <div class="checkbox-row">
          <label>
            <input type="checkbox" id="remote" /> Remote
          </label>
          <label>
            <input type="checkbox" id="hybrid" /> Hybrid
          </label>
          <label>
            <input type="checkbox" id="anywhere" /> Anywhere
          </label>
        </div>
        <small>Becomes something like ("remote" OR "work from home" OR "hybrid" ...).</small>

        <label for="location">Location filter (optional)</label>
        <input
          type="text"
          id="location"
          placeholder="City, region, or ZIP (e.g. Seattle, London, 94105)"
        />
        <small>Useful for Hybrid or specific city: "London", "10001", etc.</small>
      </section>
      <section class="section-card">
        <h2 class="section-title">Exclusions</h2>
        <div class="checkbox-row">
          <label>
            <input type="checkbox" id="excludeInternships" /> Filter out internships
          </label>
        </div>
        <div class="checkbox-row">
          <label>
            <input type="checkbox" id="excludeNews" /> Filter out news
          </label>
        </div>
        <div class="checkbox-row" id="excludePresetsRow">
          <button type="button" data-exclude-chip="contract">No contracts</button>
          <button type="button" data-exclude-chip="freelance">No freelancers</button>
          <button type="button" data-exclude-chip="agency">No agencies</button>
          <button type="button" data-exclude-chip="junior">No juniors</button>
          <button type="button" data-exclude-chip="entry level">No entry level</button>
          <button type="button" data-exclude-chip="1099">No 1099</button>
        </div>
        <textarea
          id="extraExclude"
          rows="4"
          placeholder="Other keywords to exclude (e.g. junior, entry level, contract)"
        ></textarea>
        <small>One per line or comma-separated. Each becomes -keyword.</small>
      </section>
      <section class="section-card">
        <h2 class="section-title">Search filters</h2>
        <label for="timeRange">Time range (Google-only)</label>
        <select id="timeRange">
          <option value="any">Any time</option>
          <option value="24h">Past 24 hours</option>
          <option value="3days">Past 3 days</option>
          <option value="week">Past week</option>
        </select>
        <small>
          Uses Google's <code>tbs</code> parameter. Bing / DuckDuckGo will just ignore this and use the same query.
        </small>

        <label for="operatorMode">Operator mode (between groups)</label>
        <select id="operatorMode">
          <option value="AND">AND (explicit)</option>
          <option value="SPACE">Implicit AND (space)</option>
          <option value="OR">OR</option>
        </select>
        <small>Controls how title/keywords/site/location groups are combined.</small>
      </section>
    </div>

    <section class="section-card actions-card">
      <h2 class="section-title">Run your search</h2>
      <small>Recommended to use Google primarily, other search engines may not support the query in its entirety.</small>
      <div class="actions-grid">
        <div>
          <label for="engine">Search engine</label>
          <select id="engine">
            <option value="google">Google</option>
            <option value="bing">Bing</option>
            <option value="ddg">DuckDuckGo</option>
          </select>
        </div>
        <div class="button-group">
          <button id="searchBtn" class="primary">Search</button>
          <button id="copyBtn" disabled>Copy Boolean query</button>
          <button id="clearBtn">Clear</button>
        </div>
      </div>
    </section>

    <section class="section-card output-card">
      <label class="section-title" for="outputQuery">Generated Boolean query</label>
      <textarea id="outputQuery" rows="6" readonly></textarea>
      <small>Live preview updates as you type.</small>
    </section>
  </div>

  <script>
    function parseLines(text) {
      return text
        .split(/\r?\n/)
        .map(function (l) { return l.trim(); })
        .filter(Boolean);
    }

    function parseList(text) {
      return text
        .split(/[\n,]+/)
        .map(function (l) { return l.trim(); })
        .filter(Boolean);
    }

    function quoteIfNeeded(term) {
      if (!term) return "";
      return /\s/.test(term) ? '"' + term + '"' : term;
    }

    function buildTimeRangeParam(timeRange) {
      if (timeRange === "any") return "";
      if (timeRange === "24h") return "qdr:d";
      if (timeRange === "week") return "qdr:w";
      if (timeRange === "3days") {
        var now = new Date();
        var min = new Date();
        min.setDate(now.getDate() - 3);

        function format(d) {
          var mm = String(d.getMonth() + 1).padStart(2, "0");
          var dd = String(d.getDate()).padStart(2, "0");
          var yyyy = d.getFullYear();
          return mm + "/" + dd + "/" + yyyy;
        }

        return "cdr:1,cd_min:" + format(min) + ",cd_max:" + format(now);
      }
      return "";
    }

    function buildBooleanQuery() {
      var titlesText = document.getElementById("titles").value;
      var mustIncludeText = document.getElementById("mustInclude").value;
      var companiesText = document.getElementById("companies").value;
      var sitesText = document.getElementById("sites").value;
      var remote = document.getElementById("remote").checked;
      var hybrid = document.getElementById("hybrid").checked;
      var anywhere = document.getElementById("anywhere").checked;
      var siteIndeed = document.getElementById("siteIndeed") ? document.getElementById("siteIndeed").checked : false;
      var siteLinkedIn = document.getElementById("siteLinkedIn") ? document.getElementById("siteLinkedIn").checked : false;
      var siteDice = document.getElementById("siteDice") ? document.getElementById("siteDice").checked : false;
      var siteBuiltIn = document.getElementById("siteBuiltIn") ? document.getElementById("siteBuiltIn").checked : false;
      var siteGoogleJobs = document.getElementById("siteGoogleJobs") ? document.getElementById("siteGoogleJobs").checked : false;
      var siteRobertHalf = document.getElementById("siteRobertHalf") ? document.getElementById("siteRobertHalf").checked : false;
      var locationText = document.getElementById("location").value;
      var excludeInternships = document.getElementById("excludeInternships").checked;
      var excludeNews = document.getElementById("excludeNews").checked;
      var extraExcludeText = document.getElementById("extraExclude").value;
      var requireCompanies = document.getElementById("requireCompanies").checked;
      var operatorMode = document.getElementById("operatorMode").value;

      var parts = [];
      var negativeParts = [];

      var titles = parseLines(titlesText);
      if (titles.length) {
        parts.push("(" + titles.map(quoteIfNeeded).join(" OR ") + ")");
      }

      var mustInclude = parseList(mustIncludeText);
      if (mustInclude.length) {
        parts.push("(" + mustInclude.map(quoteIfNeeded).join(" OR ") + ")");
      }

      var companies = parseList(companiesText);
      if (requireCompanies && companies.length) {
        parts.push("(" + companies.map(quoteIfNeeded).join(" OR ") + ")");
      }

      var workModeTokens = [];
      if (remote) workModeTokens.push('"remote"', '"work from home"', '"WFH"');
      if (hybrid) workModeTokens.push('"hybrid"');
      if (anywhere) workModeTokens.push('"anywhere"', '"work from anywhere"');
      if (workModeTokens.length) {
        parts.push("(" + workModeTokens.join(" OR ") + ")");
      }

      if (locationText.trim()) {
        var locList = parseList(locationText);
        if (locList.length) {
          parts.push("(" + locList.map(quoteIfNeeded).join(" OR ") + ")");
        }
      }

      var presetSites = [];
      if (siteIndeed) presetSites.push("indeed.com/jobs");
      if (siteLinkedIn) presetSites.push("linkedin.com/jobs");
      if (siteDice) presetSites.push("dice.com/jobs");
      if (siteBuiltIn) presetSites.push("builtin.com/jobs");
      if (siteGoogleJobs) presetSites.push("jobs.google.com");
      if (siteRobertHalf) presetSites.push("roberthalf.com/us/en/jobs");
      var customSites = parseLines(sitesText);
      var sites = presetSites.concat(customSites);
      if (sites.length) {
        var siteQuery = "(" + sites
          .map(function (s) { return "site:" + s.replace(/^site:/i, "").trim(); })
          .join(" OR ") + ")";
        parts.push(siteQuery);
      }

      if (excludeInternships) {
        negativeParts.push(
          "-internship",
          "-intern",
          '-"unpaid internship"',
          '-"summer internship"'
        );
      }
      if (excludeNews) {
        negativeParts.push(
          "-news",
          '-"news article"',
          "-headline"
        );
      }

      var extraExcludes = parseList(extraExcludeText);
      extraExcludes.forEach(function (term) {
        term = term.replace(/^-+/, "");
        if (!term) return;
        negativeParts.push("-" + quoteIfNeeded(term));
      });

      var joiner = " AND ";
      if (operatorMode === "SPACE") {
        joiner = " ";
      } else if (operatorMode === "OR") {
        joiner = " OR ";
      }
      var query = parts.join(joiner);
      if (negativeParts.length) {
        query = query ? query + " " + negativeParts.join(" ") : negativeParts.join(" ");
      }

      return query;
    }

    (function () {
      var searchBtn = document.getElementById("searchBtn");
      var copyBtn = document.getElementById("copyBtn");
      var outputQuery = document.getElementById("outputQuery");
      var engineSelect = document.getElementById("engine");
      var timeRangeSelect = document.getElementById("timeRange");
      var clearBtn = document.getElementById("clearBtn");
      var savedSelect = document.getElementById("savedQueries");
      var saveNameInput = document.getElementById("saveName");
      var saveBtn = document.getElementById("saveBtn");
      var loadBtn = document.getElementById("loadBtn");
      var deleteBtn = document.getElementById("deleteBtn");
      var excludePresetsRow = document.getElementById("excludePresetsRow");
      var addBookmarkBtn = document.getElementById("addBookmarkBtn");
      var bookmarkUrlInput = document.getElementById("bookmarkUrl");
      var bookmarkList = document.getElementById("bookmarkList");

      var lastQuery = "";

      function refreshQueryPreview() {
        var q = buildBooleanQuery();
        lastQuery = q || "";
        outputQuery.value = lastQuery;
        copyBtn.disabled = !lastQuery;
      }

      function getFormState() {
        return {
          titles: document.getElementById("titles").value,
          mustInclude: document.getElementById("mustInclude").value,
          companies: document.getElementById("companies").value,
          requireCompanies: document.getElementById("requireCompanies").checked,
          sites: document.getElementById("sites").value,
          siteIndeed: document.getElementById("siteIndeed") ? document.getElementById("siteIndeed").checked : false,
          siteLinkedIn: document.getElementById("siteLinkedIn") ? document.getElementById("siteLinkedIn").checked : false,
          siteDice: document.getElementById("siteDice") ? document.getElementById("siteDice").checked : false,
          siteBuiltIn: document.getElementById("siteBuiltIn") ? document.getElementById("siteBuiltIn").checked : false,
          siteGoogleJobs: document.getElementById("siteGoogleJobs") ? document.getElementById("siteGoogleJobs").checked : false,
          siteRobertHalf: document.getElementById("siteRobertHalf") ? document.getElementById("siteRobertHalf").checked : false,
          remote: document.getElementById("remote").checked,
          hybrid: document.getElementById("hybrid").checked,
          anywhere: document.getElementById("anywhere").checked,
          location: document.getElementById("location").value,
          excludeInternships: document.getElementById("excludeInternships").checked,
          excludeNews: document.getElementById("excludeNews").checked,
          extraExclude: document.getElementById("extraExclude").value,
          operatorMode: document.getElementById("operatorMode").value,
          engine: engineSelect.value,
          timeRange: timeRangeSelect.value
        };
      }

      function setFormState(state) {
        document.getElementById("titles").value = state.titles || "";
        document.getElementById("mustInclude").value = state.mustInclude || "";
        document.getElementById("companies").value = state.companies || "";
        document.getElementById("requireCompanies").checked = !!state.requireCompanies;
        document.getElementById("sites").value = state.sites || "";
        if (document.getElementById("siteIndeed")) document.getElementById("siteIndeed").checked = !!state.siteIndeed;
        if (document.getElementById("siteLinkedIn")) document.getElementById("siteLinkedIn").checked = !!state.siteLinkedIn;
        if (document.getElementById("siteDice")) document.getElementById("siteDice").checked = !!state.siteDice;
        if (document.getElementById("siteBuiltIn")) document.getElementById("siteBuiltIn").checked = !!state.siteBuiltIn;
        if (document.getElementById("siteGoogleJobs")) document.getElementById("siteGoogleJobs").checked = !!state.siteGoogleJobs;
        if (document.getElementById("siteRobertHalf")) document.getElementById("siteRobertHalf").checked = !!state.siteRobertHalf;
        document.getElementById("remote").checked = !!state.remote;
        document.getElementById("hybrid").checked = !!state.hybrid;
        document.getElementById("anywhere").checked = !!state.anywhere;
        document.getElementById("location").value = state.location || "";
        document.getElementById("excludeInternships").checked = state.excludeInternships !== false;
        document.getElementById("excludeNews").checked = state.excludeNews !== false;
        document.getElementById("extraExclude").value = state.extraExclude || "";
        document.getElementById("operatorMode").value = state.operatorMode || "AND";
        engineSelect.value = state.engine || "google";
        timeRangeSelect.value = state.timeRange || "any";
      }

      function loadSavedQueries() {
        var saved = JSON.parse(localStorage.getItem("savedQueries") || "{}");
        while (savedSelect.options.length > 1) savedSelect.remove(1);
        Object.keys(saved).forEach(function (name) {
          var opt = document.createElement("option");
          opt.value = name;
          opt.textContent = name;
          savedSelect.appendChild(opt);
        });
        var hasSelection = savedSelect.value && saved[savedSelect.value];
        loadBtn.disabled = !hasSelection;
        deleteBtn.disabled = !hasSelection;
      }

      function clearForm() {
        setFormState({
          titles: "",
          mustInclude: "",
          companies: "",
          requireCompanies: false,
          sites: "",
          remote: document.getElementById("remote").defaultChecked,
          hybrid: false,
          anywhere: false,
          location: "",
          excludeInternships: document.getElementById("excludeInternships").defaultChecked,
          excludeNews: document.getElementById("excludeNews").defaultChecked,
          extraExclude: "",
          operatorMode: "AND",
          engine: "google",
          timeRange: "any"
        });
        refreshQueryPreview();
      }

      searchBtn.addEventListener("click", function () {
        var query = buildBooleanQuery();
        lastQuery = query || "";
        outputQuery.value = lastQuery;
        copyBtn.disabled = !lastQuery;

        if (!lastQuery) {
          alert("Query is empty â€“ add at least one title or keyword.");
          return;
        }

        var engine = engineSelect.value;
        var url = "";

        if (engine === "google") {
          var base = "https://www.google.com/search";
          var tbs = buildTimeRangeParam(timeRangeSelect.value);
          url = base + "?q=" + encodeURIComponent(lastQuery);
          if (tbs) url += "&tbs=" + encodeURIComponent(tbs);
        } else if (engine === "bing") {
          url = "https://www.bing.com/search?q=" + encodeURIComponent(lastQuery);
        } else if (engine === "ddg") {
          url = "https://duckduckgo.com/?q=" + encodeURIComponent(lastQuery);
        }

        window.open(url, "_blank", "noopener,noreferrer");
      });

      copyBtn.addEventListener("click", function () {
        if (!lastQuery) return;
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(lastQuery).then(
            function () { alert("Query copied to clipboard!"); },
            function () { alert("Could not copy to clipboard, sorry ðŸ˜…"); }
          );
        } else {
          outputQuery.focus();
          outputQuery.select();
          alert("Clipboard API not available. Query selected; press Ctrl+C / Cmd+C to copy.");
        }
      });

      clearBtn.addEventListener("click", function () {
        clearForm();
      });

      excludePresetsRow.addEventListener("click", function (e) {
        var chip = e.target && e.target.getAttribute("data-exclude-chip");
        if (!chip) return;
        var field = document.getElementById("extraExclude");
        var list = parseList(field.value);
        if (!list.some(function (t) { return t.toLowerCase() === chip.toLowerCase(); })) {
          list.push(chip);
          field.value = list.join(", ");
          refreshQueryPreview();
        }
      });

      saveBtn.addEventListener("click", function () {
        var name = (saveNameInput.value || "").trim();
        if (!name) {
          alert("Please provide a name for this query.");
          return;
        }
        var saved = JSON.parse(localStorage.getItem("savedQueries") || "{}");
        saved[name] = getFormState();
        localStorage.setItem("savedQueries", JSON.stringify(saved));
        loadSavedQueries();
        savedSelect.value = name;
        loadBtn.disabled = false;
        deleteBtn.disabled = false;
        alert("Saved!");
      });

      savedSelect.addEventListener("change", function () {
        var saved = JSON.parse(localStorage.getItem("savedQueries") || "{}");
        var sel = savedSelect.value;
        var has = sel && saved[sel];
        loadBtn.disabled = !has;
        deleteBtn.disabled = !has;
      });

      loadBtn.addEventListener("click", function () {
        var saved = JSON.parse(localStorage.getItem("savedQueries") || "{}");
        var sel = savedSelect.value;
        if (!sel || !saved[sel]) return;
        setFormState(saved[sel]);
        refreshQueryPreview();
      });

      deleteBtn.addEventListener("click", function () {
        var saved = JSON.parse(localStorage.getItem("savedQueries") || "{}");
        var sel = savedSelect.value;
        if (!sel || !saved[sel]) return;
        delete saved[sel];
        localStorage.setItem("savedQueries", JSON.stringify(saved));
        loadSavedQueries();
        savedSelect.value = "";
        loadBtn.disabled = true;
        deleteBtn.disabled = true;
      });

      var liveInputs = [
        "titles","mustInclude","companies","requireCompanies","sites",
        "siteIndeed","siteLinkedIn","siteDice","siteBuiltIn","siteGoogleJobs","siteRobertHalf",
        "remote","hybrid","anywhere","location",
        "excludeInternships","excludeNews","extraExclude",
        "operatorMode","engine","timeRange"
      ];
      liveInputs.forEach(function (id) {
        var el = document.getElementById(id);
        var evt = (el.tagName === "TEXTAREA" || el.tagName === "INPUT") ? "input" : "change";
        el.addEventListener(evt, refreshQueryPreview);
        if (el.type === "checkbox") {
          el.addEventListener("change", refreshQueryPreview);
        }
      });

      loadSavedQueries();
      refreshQueryPreview();

      function normalizeUrl(u) {
        try {
          if (!/^https?:\/\//i.test(u)) u = "https://" + u;
          var url = new URL(u);
          return url.origin;
        } catch (e) {
          return "";
        }
      }
      function domainFromUrl(u) {
        try {
          var url = new URL(u);
          return url.hostname;
        } catch (e) {
          return "";
        }
      }
      function renderBookmarks() {
        var list = JSON.parse(localStorage.getItem("bookmarks") || "[]");
        bookmarkList.innerHTML = "";
        list.forEach(function (origin) {
          var a = document.createElement("a");
          a.href = origin;
          a.target = "_blank";
          a.rel = "noopener noreferrer";
          a.title = origin;
          a.style.display = "inline-flex";
          a.style.alignItems = "center";
          a.style.gap = "0.25rem";
          var img = document.createElement("img");
          var domain = domainFromUrl(origin);
          img.src = "https://www.google.com/s2/favicons?sz=32&domain=" + encodeURIComponent(domain);
          img.width = 16;
          img.height = 16;
          img.alt = domain + " favicon";
          var span = document.createElement("span");
          span.textContent = domain;
          a.appendChild(img);
          a.appendChild(span);
          bookmarkList.appendChild(a);
        });
      }
      if (addBookmarkBtn) {
        addBookmarkBtn.addEventListener("click", function () {
          var raw = (bookmarkUrlInput.value || "").trim();
          var norm = normalizeUrl(raw);
          if (!norm) {
            alert("Please enter a valid URL.");
            return;
          }
          var list = JSON.parse(localStorage.getItem("bookmarks") || "[]");
          if (list.indexOf(norm) === -1) {
            list.push(norm);
            localStorage.setItem("bookmarks", JSON.stringify(list));
          }
          bookmarkUrlInput.value = "";
          renderBookmarks();
        });
      }
      renderBookmarks();
    })();
  </script>
</body>
</html>
